# Known Issues / 既知の問題

## インラインコード表示の不具合（メッセージ一覧）

### 問題の概要
メッセージ一覧において、バッククォート（`` ` ``）で囲まれたインラインコードが正しく表示されません。

**例:**
- 期待される表示: `` `inline code` `` → ピンク色のインラインコード表示
- 実際の表示: `inline code` → 通常のテキストとして表示（バッククォートが削除される）

### 影響範囲
- **メッセージ一覧**: ❌ インラインコードが正しく表示されない
- **スレッド表示**: ✅ 正常に表示される

### 原因
Slack APIの仕様による制限です：

1. **search.messages API**（メッセージ一覧で使用）
   - 検索用に最適化された前処理済みテキストを返す
   - バッククォートなどのマークダウン記号が削除される
   - 例: `` `code` `` → `code`

2. **conversations.replies API**（スレッド表示で使用）
   - 生のテキストをそのまま返す
   - マークダウン記号が保持される
   - 例: `` `code` `` → `` `code` ``

### 技術的詳細
```
# メッセージ一覧のAPIレスポンス
text: "inline display"  # バッククォートが削除されている

# スレッド表示のAPIレスポンス
text: "`inline display`"  # バッククォートが保持されている
```

### 解決策の検討
完全な解決には以下のいずれかのバックエンド修正が必要です：

1. search.messages APIの代わりにconversations.history APIを使用
2. 検索後に各メッセージの生データを個別に取得
3. Slack APIの`blocks`フィールドから元のフォーマット情報を復元

ただし、これらの変更は：
- パフォーマンスへの影響が大きい
- API呼び出し数が増加する可能性がある
- 実装の複雑性が高い

### 現在の対応
現時点では、この制限を受け入れて運用しています。正確なマークダウン表示が必要な場合は、スレッド表示で確認してください。

---

## 既読機能の制限（スレッドメッセージ）

### 問題の概要
実装済みの既読機能（Shift+Rキーボードショートカット）では、Slack側でスレッドとして表示されるメッセージを既読にすることができません。

### 影響範囲
- **チャンネルメッセージ（親メッセージ）**: ✅ 既読マーク可能
- **スレッド内のメッセージ（返信）**: ❌ 既読マークできない
- **DM（ダイレクトメッセージ）**: ✅ 既読マーク可能

### 原因
Slack APIの仕様による制限です：

**使用API**: `conversations.mark`
- チャンネル単位でのメッセージ既読マークをサポート
- スレッド内の個別メッセージの既読状態は管理しない
- `thread_ts`パラメータによるスレッドメッセージの既読マークに対応していない

### 技術的詳細
```typescript
// 現在の実装
await invoke<void>('mark_as_read', {
  channel: message.channel,
  ts: message.ts  // スレッドメッセージの場合、このtsでは既読マークできない
});
```

### 回避策
スレッド内のメッセージを既読にするには、Slack公式アプリで該当スレッドを開いて確認する必要があります。

### 将来的な対応
現在のSlack API仕様では、スレッドメッセージの個別既読マークは提供されていません。Slack APIの仕様変更があれば対応を検討します。

---

## チャンネル/ユーザー検索の表示エリア制限

### 問題の概要
チャンネル検索およびユーザー検索において、初期表示のエリアを拡大できません。拡大表示するためには、複数回下矢印キーを押してスクロールする必要があります。

### 影響範囲
- **チャンネル検索**: ❌ 初期表示エリアが制限される
- **ユーザー検索**: ❌ 初期表示エリアが制限される

### 現在の対応
ユーザーは下矢印キーを複数回押して、表示エリアを手動で拡大する必要があります。

---

## アクセスキーの挙動不安定

### 問題の概要
検索を実行した後など、特定の操作を行った後にアクセスキーの挙動が不安定になります。

### 影響範囲
- **検索実行後**: ❌ アクセスキーが期待通りに動作しないことがある
- **その他の操作後**: ❌ 不安定な挙動が発生する可能性がある

### 現在の対応
現時点では、この問題の根本原因を調査中です。

---

## スレッドメッセージへの絵文字リアクション制限

### 問題の概要
スレッドに含まれるメッセージの場合、メッセージ一覧でフォーカスを当てても絵文字リアクションを追加できません。また、他のユーザーがつけた絵文字リアクションをショートカットキーで選択することもできません。

### 影響範囲
- **メッセージ一覧**: ❌ スレッドメッセージに絵文字リアクションを追加できない
- **スレッド一覧**: ✅ 正常に絵文字リアクションを追加できる
- **ショートカットキー**: ❌ 既存の絵文字リアクションを選択できない

### 現在の対応
スレッドメッセージに絵文字リアクションを追加する場合は、スレッド一覧画面でフォーカスを当てて操作してください。

---

## Saved SearchesでのDMチャンネル表示問題

### 問題の概要
「Saved searches」機能において、DMチャンネルがチャンネル名ではなく、チャンネルIDとして表示されてしまいます。

### 影響範囲
- **Saved searches**: ❌ DMチャンネルがIDで表示される
- **通常のチャンネル**: ✅ チャンネル名が正しく表示される

### 現在の対応
現時点では、チャンネルIDからチャンネル名へのマッピング処理が不完全です。改善を検討中です。

---

## "New"バッジの表示不具合

### 問題の概要
キャッシュに含まれないメッセージを取得した際、「New」バッジが表示されるべきですが、表示されないことがあります。逆に、キャッシュされているはずのメッセージに誤ってバッジが表示されることもあります。

### 影響範囲
- **未キャッシュメッセージ**: ⚠️ 「New」バッジが表示されないことがある
- **キャッシュ済みメッセージ**: ⚠️ 誤って「New」バッジが表示されることがある

### 原因
キャッシュ状態とバッジ表示ロジックの同期に問題がある可能性があります。

### 現在の対応
キャッシュ管理とバッジ表示の実装を見直し中です。

---

## 絵文字リアクション送信の不具合

### 問題の概要
reactionPickerにて絵文字リアクションを選択した際、選択していない別の絵文字リアクションが送信されてしまうことがあります。

### 影響範囲
- **reactionPicker**: ⚠️ 選択した絵文字とは異なる絵文字が送信されることがある

### 原因
絵文字選択とAPI送信の間でデータのマッピングに問題がある可能性があります。

### 現在の対応
reactionPickerの実装を調査し、選択と送信のロジックを修正予定です。

---
*最終更新: 2025年10月23日*
