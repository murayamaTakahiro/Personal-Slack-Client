<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji Search Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }
        input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }
        .emoji-item {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
            border-radius: 4px;
            background: #f9f9f9;
        }
        .emoji-name {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
            word-break: break-all;
        }
        .match-type {
            font-size: 10px;
            color: #999;
            background: #eee;
            padding: 2px 4px;
            border-radius: 2px;
            margin-top: 3px;
            display: inline-block;
        }
        .emoji-display {
            font-size: 24px;
            min-height: 30px;
        }
        .info {
            background: #e8f4fd;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        h2 {
            margin-top: 0;
        }
        .test-queries {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        .test-btn {
            padding: 5px 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-btn:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Emoji Search Test</h1>
        
        <div class="info">
            <h2>Test Queries:</h2>
            <div class="test-queries">
                <button class="test-btn" onclick="testSearch('ojigi')">ojigi</button>
                <button class="test-btn" onclick="testSearch('man')">man</button>
                <button class="test-btn" onclick="testSearch('bow')">bow</button>
                <button class="test-btn" onclick="testSearch('dansei')">dansei</button>
                <button class="test-btn" onclick="testSearch('Áî∑ÊÄß')">Áî∑ÊÄß</button>
                <button class="test-btn" onclick="testSearch('„ÅäËæûÂÑÄ')">„ÅäËæûÂÑÄ</button>
                <button class="test-btn" onclick="testSearch('pray')">pray</button>
                <button class="test-btn" onclick="testSearch('pray-man')">pray-man</button>
            </div>
            <p>This tests the emoji search functionality to ensure "ojigi_dansei" can be found.</p>
        </div>
        
        <input type="text" id="searchInput" placeholder="Search for emojis..." autofocus>
        
        <div id="results" class="results"></div>
    </div>

    <script type="module">
        // Mock emoji data for testing
        const mockEmojiData = {
            custom: {
                'ojigi_dansei': 'https://example.com/ojigi_dansei.png',
                'ojigi_josei': 'https://example.com/ojigi_josei.png',
                'ojigi': 'https://example.com/ojigi.png',
                'pray-man': 'https://example.com/pray-man.png',
                'pray-woman': 'https://example.com/pray-woman.png',
                'arigataya': 'https://example.com/arigataya.png',
                'kakunin': 'https://example.com/kakunin.png',
            },
            standard: {
                'pray': 'üôè',
                'man': 'üë®',
                'woman': 'üë©',
                'bow': 'üôá',
                'thumbsup': 'üëç',
            }
        };

        // English aliases mapping
        const ENGLISH_ALIASES = {
            'ojigi': ['bow', 'bowing', 'respect'],
            'ojigi_dansei': ['man bowing', 'male bow', 'bowing man'],
            'ojigi_josei': ['woman bowing', 'female bow', 'bowing woman'],
            'dansei': ['man', 'male', 'gentleman'],
            'josei': ['woman', 'female', 'lady'],
        };

        // Japanese to Romaji mapping
        const JAPANESE_ROMAJI_MAP = {
            '„ÅäËæûÂÑÄ': ['ojigi'],
            'Áî∑ÊÄß': ['dansei', 'otoko'],
            'Â•≥ÊÄß': ['josei', 'onna'],
        };

        function searchEmojis(query) {
            const results = [];
            const normalizedQuery = query.toLowerCase().trim();
            
            // Check all emojis
            const allEmojis = [
                ...Object.entries(mockEmojiData.custom).map(([name, url]) => ({ name, value: url, isCustom: true })),
                ...Object.entries(mockEmojiData.standard).map(([name, unicode]) => ({ name, value: unicode, isCustom: false }))
            ];
            
            for (const emoji of allEmojis) {
                let score = 0;
                let matchType = '';
                let matchedOn = '';
                
                // Exact match
                if (emoji.name.toLowerCase() === normalizedQuery) {
                    score = 100;
                    matchType = 'exact';
                    matchedOn = emoji.name;
                }
                // Check if emoji name contains query
                else if (emoji.name.toLowerCase().includes(normalizedQuery)) {
                    score = 80;
                    matchType = 'partial';
                    matchedOn = emoji.name;
                }
                // Check parts of underscore-separated names
                else {
                    const nameParts = emoji.name.toLowerCase().split(/[_\-]/);
                    for (const part of nameParts) {
                        // Direct match on part
                        if (part === normalizedQuery) {
                            score = 85;
                            matchType = 'partial';
                            matchedOn = part;
                            break;
                        }
                        // Part contains query
                        else if (part.includes(normalizedQuery)) {
                            score = 75;
                            matchType = 'partial';
                            matchedOn = part;
                            break;
                        }
                        // Check English aliases for this part
                        if (ENGLISH_ALIASES[part]) {
                            for (const alias of ENGLISH_ALIASES[part]) {
                                if (alias.toLowerCase().includes(normalizedQuery) || normalizedQuery.includes(alias.toLowerCase())) {
                                    score = 70;
                                    matchType = 'alias';
                                    matchedOn = `${part} -> ${alias}`;
                                    break;
                                }
                            }
                        }
                    }
                }
                
                // Check full emoji name in aliases
                if (score === 0 && ENGLISH_ALIASES[emoji.name]) {
                    for (const alias of ENGLISH_ALIASES[emoji.name]) {
                        if (alias.toLowerCase().includes(normalizedQuery)) {
                            score = 90;
                            matchType = 'alias';
                            matchedOn = alias;
                            break;
                        }
                    }
                }
                
                // Check Japanese mappings
                if (score === 0) {
                    for (const [japanese, romajis] of Object.entries(JAPANESE_ROMAJI_MAP)) {
                        if (japanese === normalizedQuery || romajis.includes(normalizedQuery)) {
                            // Look for emojis containing this
                            if (emoji.name.toLowerCase().includes(romajis[0])) {
                                score = 85;
                                matchType = 'romaji';
                                matchedOn = `${japanese} -> ${romajis[0]}`;
                                break;
                            }
                        }
                    }
                }
                
                if (score > 0) {
                    results.push({
                        ...emoji,
                        score,
                        matchType,
                        matchedOn
                    });
                }
            }
            
            // Sort by score
            results.sort((a, b) => b.score - a.score);
            return results;
        }

        function displayResults(results) {
            const container = document.getElementById('results');
            
            if (results.length === 0) {
                container.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #666;">No emojis found</p>';
                return;
            }
            
            container.innerHTML = results.map(result => `
                <div class="emoji-item">
                    <div class="emoji-display">
                        ${result.isCustom ? `<img src="${result.value}" alt="${result.name}" style="width: 24px; height: 24px;">` : result.value}
                    </div>
                    <div class="emoji-name">${result.name}</div>
                    <div class="match-type">${result.matchType}</div>
                    ${result.matchedOn ? `<div style="font-size: 9px; color: #aaa;">${result.matchedOn}</div>` : ''}
                </div>
            `).join('');
        }

        function testSearch(query) {
            const input = document.getElementById('searchInput');
            input.value = query;
            performSearch();
        }

        function performSearch() {
            const query = document.getElementById('searchInput').value;
            const results = searchEmojis(query);
            console.log(`Search for "${query}":`, results);
            displayResults(results);
        }

        // Set up search input
        document.getElementById('searchInput').addEventListener('input', performSearch);
        
        // Initial search
        performSearch();
    </script>
</body>
</html>