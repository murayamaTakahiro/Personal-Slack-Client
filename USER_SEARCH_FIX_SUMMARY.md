# ユーザー指定検索の修正サマリー

## 問題の概要
チャンネルとユーザーを指定して検索すると、実際には8件以上のメッセージがあるにもかかわらず、7件しか取得できない問題が発生していました。

## 原因
`conversations.history` APIの実装にページネーション機能がなく、1回のAPIコールで返されるメッセージ（デフォルトでは最新の100件以下）しか取得していませんでした。Slack APIはカーソルベースのページネーションをサポートしているため、すべてのメッセージを取得するには複数回のAPIコールが必要です。

## 修正内容
`src-tauri/src/slack/client.rs`ファイルの以下の関数にページネーション機能を実装しました：

### 1. `get_channel_messages`関数
- `ConversationsHistoryResponse`構造体に`has_more`と`response_metadata`フィールドを追加
- カーソルベースのページネーションを実装
- 最大10回までAPIコールを繰り返し、すべてのメッセージを取得
- 1回のAPIコールあたり最大200件のメッセージを取得（Slack推奨値）

### 2. `get_channel_messages_with_reactions`関数
- 同様のページネーション機能を実装
- リアクション情報も含めて取得

## 技術的詳細

### ページネーション実装の流れ
1. 初回APIコールでメッセージを取得
2. レスポンスの`has_more`フィールドをチェック
3. `true`の場合、`response_metadata.next_cursor`を使用して次のページを取得
4. すべてのメッセージを取得するか、制限に達するまで繰り返し

### 安全対策
- APIコール回数の上限を10回に設定（無限ループ防止）
- 要求されたメッセージ数に達したら処理を終了
- エラーハンドリングとログ出力の強化

## 期待される効果
- チャンネル内のすべてのメッセージから正確にユーザーのメッセージをフィルタリング可能
- 大量のメッセージがあるチャンネルでも完全な検索結果を取得
- API制限を考慮した効率的なデータ取得

## テスト方法
1. アプリケーションを再起動
2. チャンネルとユーザーを指定して検索実行
3. ログで複数のAPIコール（"API call 1 for conversations.history", "API call 2..."）を確認
4. 実際のユーザーのメッセージ数と取得されたメッセージ数を比較

## 注意事項
- 大量のメッセージがあるチャンネルでは、初回の検索に時間がかかる可能性があります
- Slack APIのレート制限に注意が必要です（既存のレート制限機構で対応）