<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Standard Emoji Search Test</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            background: #1a1a1a;
            color: #e0e0e0;
        }
        
        h1 { color: #4a9eff; }
        h2 { color: #7ab8ff; margin-top: 30px; }
        
        .test-case {
            background: #2a2a2a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid #3a3a3a;
        }
        
        .search-query {
            font-weight: bold;
            color: #ffa500;
            font-size: 1.1em;
        }
        
        .emoji-result {
            display: inline-block;
            margin: 10px;
            padding: 10px;
            background: #333;
            border-radius: 6px;
            text-align: center;
            min-width: 100px;
        }
        
        .emoji-display {
            font-size: 2em;
            margin-bottom: 5px;
        }
        
        .emoji-name {
            font-size: 0.9em;
            color: #aaa;
        }
        
        .emoji-type {
            font-size: 0.8em;
            color: #4a9eff;
            margin-top: 3px;
        }
        
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        
        .status.success {
            background: #1a4d1a;
            color: #4dff4d;
        }
        
        .status.error {
            background: #4d1a1a;
            color: #ff4d4d;
        }
        
        .loading {
            color: #ffa500;
        }
        
        input {
            padding: 10px;
            font-size: 1.1em;
            background: #333;
            color: #e0e0e0;
            border: 1px solid #555;
            border-radius: 4px;
            margin-right: 10px;
        }
        
        button {
            padding: 10px 20px;
            font-size: 1.1em;
            background: #4a9eff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background: #3a8eef;
        }
    </style>
</head>
<body>
    <h1>Standard Emoji Search Test</h1>
    
    <div style="margin: 20px 0;">
        <input type="text" id="searchInput" placeholder="Enter search term (e.g., man, woman, bow)">
        <button onclick="performSearch()">Search</button>
    </div>
    
    <div id="results"></div>
    
    <h2>Automated Test Cases</h2>
    <div id="testResults"></div>
    
    <script type="module">
        // Import the services
        import { emojiService, emojiData } from './src/lib/services/emojiService.ts';
        import { emojiSearchService } from './src/lib/services/emojiSearchService.ts';
        import { get } from 'svelte/store';
        
        // Make them globally available
        window.emojiService = emojiService;
        window.emojiSearchService = emojiSearchService;
        window.getEmojiData = () => get(emojiData);
        
        // Initialize services
        async function init() {
            const status = document.createElement('div');
            status.className = 'status loading';
            status.textContent = 'Initializing emoji services...';
            document.getElementById('testResults').appendChild(status);
            
            try {
                await emojiService.initialize();
                
                // Wait a bit for the search index to build
                await new Promise(resolve => setTimeout(resolve, 100));
                
                status.className = 'status success';
                status.textContent = 'Emoji services initialized successfully!';
                
                // Run automated tests
                runTests();
            } catch (error) {
                status.className = 'status error';
                status.textContent = 'Failed to initialize: ' + error.message;
                console.error(error);
            }
        }
        
        function runTests() {
            const testCases = [
                { query: 'man', expected: ['man', 'older_man', 'man_bowing', 'man_dancing'] },
                { query: 'woman', expected: ['woman', 'older_woman', 'woman_bowing', 'pregnant_woman'] },
                { query: 'bow', expected: ['person_bowing', 'man_bowing', 'woman_bowing', 'ojigi'] },
                { query: 'person', expected: ['person', 'person_bowing', 'person_walking', 'person_running'] },
                { query: 'male', expected: ['man', 'boy', 'man_bowing'] },
                { query: 'female', expected: ['woman', 'girl', 'woman_bowing'] },
                { query: 'walk', expected: ['person_walking'] },
                { query: 'run', expected: ['person_running'] },
                { query: 'dance', expected: ['dancer', 'man_dancing'] },
                { query: 'family', expected: ['family'] },
                { query: 'cop', expected: ['police_officer'] },
                { query: 'baby', expected: ['baby'] }
            ];
            
            const resultsDiv = document.getElementById('testResults');
            
            testCases.forEach(testCase => {
                const results = emojiSearchService.search(testCase.query, 20);
                
                const testDiv = document.createElement('div');
                testDiv.className = 'test-case';
                
                const queryDiv = document.createElement('div');
                queryDiv.innerHTML = `<span class="search-query">Search: "${testCase.query}"</span>`;
                testDiv.appendChild(queryDiv);
                
                const expectedDiv = document.createElement('div');
                expectedDiv.style.marginTop = '10px';
                expectedDiv.innerHTML = `<strong>Expected to find:</strong> ${testCase.expected.join(', ')}`;
                testDiv.appendChild(expectedDiv);
                
                const foundDiv = document.createElement('div');
                foundDiv.style.marginTop = '10px';
                
                const foundNames = results.map(r => r.name);
                const foundExpected = testCase.expected.filter(name => 
                    foundNames.some(found => found.includes(name) || name.includes(found))
                );
                
                const successRate = (foundExpected.length / testCase.expected.length * 100).toFixed(0);
                const statusText = foundExpected.length === testCase.expected.length ? 
                    '‚úÖ All expected emojis found!' : 
                    `‚ö†Ô∏è Found ${foundExpected.length}/${testCase.expected.length} expected (${successRate}%)`;
                
                foundDiv.innerHTML = `<strong>Result:</strong> ${statusText}`;
                testDiv.appendChild(foundDiv);
                
                const resultsGrid = document.createElement('div');
                resultsGrid.style.display = 'flex';
                resultsGrid.style.flexWrap = 'wrap';
                resultsGrid.style.marginTop = '10px';
                
                results.slice(0, 10).forEach(result => {
                    const emojiDiv = document.createElement('div');
                    emojiDiv.className = 'emoji-result';
                    
                    const displayDiv = document.createElement('div');
                    displayDiv.className = 'emoji-display';
                    displayDiv.textContent = result.isCustom ? 'üñºÔ∏è' : result.value;
                    
                    const nameDiv = document.createElement('div');
                    nameDiv.className = 'emoji-name';
                    nameDiv.textContent = result.name;
                    
                    const typeDiv = document.createElement('div');
                    typeDiv.className = 'emoji-type';
                    typeDiv.textContent = result.isCustom ? 'Custom' : 'Standard';
                    
                    emojiDiv.appendChild(displayDiv);
                    emojiDiv.appendChild(nameDiv);
                    emojiDiv.appendChild(typeDiv);
                    
                    resultsGrid.appendChild(emojiDiv);
                });
                
                testDiv.appendChild(resultsGrid);
                resultsDiv.appendChild(testDiv);
            });
            
            // Show emoji counts
            const data = window.getEmojiData();
            const countDiv = document.createElement('div');
            countDiv.className = 'status success';
            countDiv.style.marginTop = '20px';
            countDiv.innerHTML = `
                <strong>Emoji Statistics:</strong><br>
                Standard Emojis: ${Object.keys(data.standard).length}<br>
                Custom Emojis: ${Object.keys(data.custom).length}<br>
                Total: ${Object.keys(data.standard).length + Object.keys(data.custom).length}
            `;
            resultsDiv.appendChild(countDiv);
        }
        
        window.performSearch = function() {
            const query = document.getElementById('searchInput').value;
            if (!query) return;
            
            const results = emojiSearchService.search(query, 30);
            const resultsDiv = document.getElementById('results');
            
            resultsDiv.innerHTML = `<h2>Search Results for "${query}" (${results.length} found)</h2>`;
            
            const grid = document.createElement('div');
            grid.style.display = 'flex';
            grid.style.flexWrap = 'wrap';
            
            results.forEach(result => {
                const emojiDiv = document.createElement('div');
                emojiDiv.className = 'emoji-result';
                
                const displayDiv = document.createElement('div');
                displayDiv.className = 'emoji-display';
                displayDiv.textContent = result.isCustom ? 'üñºÔ∏è' : result.value;
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'emoji-name';
                nameDiv.textContent = result.name;
                
                const typeDiv = document.createElement('div');
                typeDiv.className = 'emoji-type';
                typeDiv.textContent = result.isCustom ? 'Custom' : 'Standard';
                
                if (result.matchedOn) {
                    const matchDiv = document.createElement('div');
                    matchDiv.style.fontSize = '0.75em';
                    matchDiv.style.color = '#888';
                    matchDiv.textContent = `Matched: ${result.matchedOn}`;
                    emojiDiv.appendChild(matchDiv);
                }
                
                emojiDiv.appendChild(displayDiv);
                emojiDiv.appendChild(nameDiv);
                emojiDiv.appendChild(typeDiv);
                
                grid.appendChild(emojiDiv);
            });
            
            resultsDiv.appendChild(grid);
        };
        
        // Initialize on load
        init();
    </script>
</body>
</html>